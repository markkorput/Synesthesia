// Generated by CoffeeScript 1.6.3
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  this.Motgraphs = (function() {
    function Motgraphs(opts) {
      this.updateChart = __bind(this.updateChart, this);
      var server,
        _this = this;
      this.options = opts;
      server = io.connect('/motgraphs');
      server.on('welcome', function(data) {
        return console.log('welcomed');
      });
      server.on('motionData', function(data) {
        return _this.update(data);
      });
      server.on('audio', function(data) {
        return console.log("[warning] shouldn't be receiving audio");
      });
      this.alphas = [];
      this.betas = [];
      this.gammas = [];
      this.chart = new CanvasJS.Chart("chartContainer", {
        title: {
          text: "Motion Data"
        },
        data: [
          {
            type: "line",
            dataPoints: this.alphas
          }, {
            type: "line",
            dataPoints: this.betas
          }, {
            type: "line",
            dataPoints: this.gammas
          }
        ]
      });
      this.startdate = new Date();
      setInterval(this.updateChart, 100);
      console.log('[debug] Motgraphs initialized');
    }

    Motgraphs.prototype.update = function(data) {
      if (!this.lastData) {
        console.log('Motiondata:', data);
      }
      return this.lastData = data;
    };

    Motgraphs.prototype.updateChart = function() {
      var data, x;
      x = ((new Date().getTime()) - this.startdate.getTime()) / 1000;
      data = this.lastData || {
        alpha: 0,
        beta: 0,
        gamma: 0
      };
      this.alphas.push({
        x: x,
        y: data.alpha
      });
      this.betas.push({
        x: x,
        y: data.beta
      });
      this.gammas.push({
        x: x,
        y: data.gamma
      });
      while (this.alphas.length > 150) {
        this.alphas.shift();
      }
      while (this.betas.length > 150) {
        this.betas.shift();
      }
      while (this.gammas.length > 150) {
        this.gammas.shift();
      }
      return this.chart.render();
    };

    return Motgraphs;

  })();

  $(document).ready(function() {
    return window.motgraphs = new Motgraphs();
  });

}).call(this);
